!function(){function r(){var e={};var n=a(o);e.htmlTagHandler=o,e.lispTree=i,e.customTagMarkupConverter=a,e.toHtml=function(r,t){{if("string"==typeof r)return n(i(r),t);if(Array.isArray(r))return n(r,t)}},e.compileTemplate=function(t,r){"string"==typeof t&&(t=i(t));if(!Array.isArray(t))throw new Error("LispMarkup.compileTemplate: Template must be a lisp tree or an array.");var e;e=r?a(r):n;return function(r){return e(t,r)}},e.addMacro=t,e.addFunction=function(i,r){t(i,(a=r,function(r,t,e){for(var n=[],o=1;o<r.length;++o)n.push(e(r[o],t));return console.log("function",i,n),a.apply(null,n)}));var a},e.hasMacro=function(r){return m.hasOwnProperty(r)};var m=function(){var r={WITH:function(r,t,e){var n=[];if(r.length<3)throw new Error("LispMarkup.macros._with not enough list arguments");var o=r[1];if(null===t||"undefined"===t)throw new Error("LispMarkup.macros._with data is not defined");if("function"==typeof o)t=o(t);else{if("string"!=typeof o&&"number"!=typeof o)throw new Error("LispMarkup.macros._with invalid type for context argument");t=t[o]}for(var i=2;i<r.length;++i)n.push(e(r[i],t,e));return n.join("")}};return r.COMMENT=n,r.CONCAT=i,r.CONCAT_SPACE=a,r.IF=e,r.GET=s,r.CSS=function(r,u,p){for(var t=["<style>"],e=1;e<r.length;++e)t.push(a(r[e]));return t.push("</style>"),t.join("");function f(r){var t=[];if("function"==typeof r){if("string"!=typeof(r=r(u)))throw new Error("LispMarkup.macros.css: tranform function for css rule did not return a string value.");t.push(r)}else if("string"==typeof r)t.push(r);else if(Array.isArray(r)){var e=r[0];if("function"==typeof e)return f(e(r,u,p));if("string"!=typeof e)throw new Error("LispMarkup.macros.css: css rule property not a string");if(r.length<2)throw new Error("LispMarkup.macros.css: css rule must have at least 2 entries, a property and a value");for(var n=e,o=[],i=1;i<r.length;++i){var a=r[i];if(Array.isArray(a)){if("function"!=typeof a[0])throw new Error("LispMarkup.macros.css: if css rule value is a list, it must be a macro call.");var s=a[0](a,u,p);o.push(s)}else if("function"==typeof a)o.push(a(u));else{if("string"!=typeof a)throw new Error("LispMarkup.macros.css: css rule value not a string, macro call, or view returning a string.");o.push(a)}}t.push(n+": "+o.join(" ")+"; ")}return t.join("")}function a(r){var t=[];if("string"==typeof r)t.push(r);else if("function"==typeof r){if("string"!=typeof(r=r(u)))throw new Error("LispMarkup.macros.css: css entry view did not return a string");t.push(r)}else{if(!Array.isArray(r))throw new Error("LispMarkup.macros.css: invalid entry type");var e=r[0];if("function"==typeof e)return a(e(r,u,p));if("string"!=typeof e)throw new Error("LispMarkup.macros.css: invalid selector type");var n=e;t.push(n+"{");for(var o=1;o<r.length;++o){var i=r[o];t.push(f(i))}t.push("}")}return t.join("")}},r.LET=o,r.FOR=function(r,t,e){var n,o=r[1],i=/^(0|[-]?[1-9][0-9]*)$/;if(r.length<2)throw new Error("LispMarkup.macros.FOR: at least 1 argument required.");if((n=Array.isArray(o)?o:[o]).length<1)throw new Error("LispMarkup.macros.FOR: param list is empty.");if(4<n.length)throw new Error("LispMarkup.macros.FOR: param list exceeds 4 maximum entries.");var a=0,s=t,u=null,p=null,f=1;if("string"==typeof(h=n[a])&&h.match(i)){++a;var l=parseInt(h);l<0?(u=l,p=-1):(u=1,p=l)}if(0==a&&("string"!=typeof h||"$"!=h[0])){var c=h;if(++a,null==s)throw new Error("LispMarkup.macros.FOR: data is not defined");if("function"==typeof c)s=c(s);else{if("string"!=typeof c&&"number"!=typeof c)throw new Error("LispMarkup.macros.FOR: invalid type for context argument");s=s[c]}}if(null!==u){if(a<n.length){var h=n[a];if(h.toString().match(i)&&(++a,u=p,p=parseInt(h),a<n.length)){var h=n[a];h.match(i)&&(++a,f=parseInt(h))}}}else if(!Array.isArray(s)&&"object"!=typeof s)throw new Error("LispMarkup.macros.FOR: loop_data context can't be iterated over, not array or object");var g=null,v=null;if(a<n.length){var h=n[a];if(++a,"string"!=typeof h||"$"!=h[0])throw new Error("LispMarkup.macros.FOR: expected '$' prefixed variable name for loop index or key");g=h.substr(1)}if(null==u&&a<n.length){var h=n[a];if(++a,"string"!=typeof h||"$"!=h[0])throw new Error("LispMarkup.macros.FOR: expected '$' prefixed variable name for loop number");v=h.substr(1)}if(a!=n.length)throw new Error("LispMarkup.macros.FOR: not all arguments were used.");var w=r.slice(2),y=[],m={},d=[];if(null!==g)m[g]="",null!==v&&(m[v]="");else if(null!==v)throw new Error("LispMarkup.macros.FOR: loop value variable unexpectedly assigned when loop reference variable was not.");if(null!==u){p<u&&0<f&&(f=-f);for(var L=u;0<f?L<=p:p<=L;L+=f)d.push([L,null])}else if(Array.isArray(s))for(var L=0;L<s.length;++L)d.push([L+1,s[L]]);else if("object"==typeof s)for(var M in s)d.push([M,s[M]]);for(var L=0;L<d.length;++L){var k=d[L][0],E=d[L][1],b=t;null!==g&&(m[g]=k),null!==E&&(null!==v?m[v]=E:b=E);for(var A=g?j(w,m):w,T=0;T<A.length;++T)y.push(e(A[T],b))}return y.join("")},r.STRINGIFY=function(r,t,e){if(1==r.length)return JSON.stringify(t);if(2==r.length)return JSON.stringify(t[r[1]]);throw new Error("LispMarkup.macros.STRINGIFY: only 0 or 1 arguments allowed.")},r.PROPERTIES=t,r.PROPS=t,r["?"]=e,r["."]=s,r[".."]=i,r["..."]=a,r["//"]=n,r[":"]=t,r["="]=o,r;function t(r,t,e){for(var n={},o=1;o<r.length-1;o+=2)n[r[o]]=r[o+1];return n}function e(r,t,e){if(r.length<4)throw new Error("LispMarkup.macros._if not enough list arguments");var n=r[1],o=!1;if("function"==typeof n)o=n(t);else if("string"==typeof n||"number"==typeof context)o=t[n];else if("boolean"==typeof n)o=n;else{if(isNaN(n))throw new Error("LispMarkup.macros._if invalid type for context argument");o=0!=n}return e(o?r[2]:r[3],t,e)}function n(r,t,e){return""}function o(r,t,e){var n,o=r[1],i={};if(r.length<3)throw new Error("LispMarkup.macros.LET: At least 2 arguments are required");if((n=Array.isArray(o)?o:[r[1],r[2]]).length%2!=0)throw new Error("LispMarkup.macros.LET: assignment list must be even length.");for(var a=0;a<n.length;a+=2){var s=n[a],u=n[a+1];if(Array.isArray(u)&&(u=e(u,t)),"function"==typeof s&&(u=u(t)),"string"!=typeof s||"string"!=typeof u)throw new Error("LispMarkup.macros.LET: variable name was not a string.");if("string"!=typeof s||"string"!=typeof u)throw new Error("LispMarkup.macros.LET: variable value not a string or convertible to string");if("$"!=s.charAt(0))throw new Error("LispMarkup.macros.LET: variable must begin with '$'");if(i.hasOwnProperty(s))throw new Error("LispMarkup.macros.LET: variable '"+s+"' assigned previously in this let statement.");i[s.substring(1)]=u}for(var r=j(r.slice(Array.isArray(o)?2:3),i),p=[],a=0;a<r.length;++a)p.push(e(r[a],t).toString());return p.join("")}function j(r,t){if("object"!=typeof t)throw new Error("LispMarkup.substitute: vars must be an object map");if(Array.isArray(r)){for(var e=[],n=0;n<r.length;++n)e[n]=j(r[n],t);return e}if("object"==typeof r){var e={};for(var o in r)e[o]=j(r[o],t);return r}if("string"==typeof r){for(var i=[],n=0,o=0;n<r.length;++n){var a=r[n];if("\\"==a&&++n,"'"==a)for(;++n<r.length&&"'"!=r[n];)"\\"==r[n]&&++n;if("$"==a){var s=n+1,u="";if(++n<r.length&&"{"==r[n]){for(;++n<r.length&&"}"!=r[n];);u=r.substring(s+1,n),++n,console.log(u)}else{for(;n<r.length&&r[n].match(/[_0-9A-Za-z]/);)++n;u=r.substring(s,n)}u.length&&t.hasOwnProperty(u)&&(i.push(r.substring(o,s-1),t[u]),o=n)}}return i.push(r.substring(o)),i.join("")}return r}function i(r,t,e){for(var n=[""],o=1;o<r.length;++o){var i=e(r[o],t);n.push(i.toString().trim())}return n.join("")}function a(r,t,e){for(var n=[""],o=1;o<r.length;++o){var i=e(r[o],t);n.push(i.toString())}return n.join("")}function s(r,t,e){if(1==r.length)return t.toString();if(2==r.length)return t[r[1]]?t[r[1]].toString():"";if(3==r.length){var n=t[r[1]];return null==n&&(n=e(r[2],t,e)),n.toString()}throw new Error("LispMarkup.macros.get invalid number of list arguments")}}();for(var r in e.macros={},m)e.macros[r]=m[r];return e;function t(r,t){if(m.hasOwnProperty(r))throw new Error("LispMarkup.addMacro: macro '"+r+"' already exists.");m[r]=t,e.macros[r]=t}function o(t,e){e||(e={});var r=["<"],n=0,o=0,i=[],a="",s="tag";function u(){var r=t.substr(n,o-n);"tag"==s&&(a=r),"id"==s&&(e.id=r),"class"==s&&i.push(r),n=o+1}for(;o<t.length;++o){var p=t[o];"#"==p&&(u(),s="id"),"."==p&&(u(),s="class")}n<o&&u(),0==a.length&&(a="div"),r.push(a);var f=[];for(var l in e)f.push(l,e[l]);for(n=0;n<f.length-1;n+=2){var c=f[n],h=f[n+1];null==h?r.push(" ",c):r.push(" ",c,'="',h,'"')}if(i.length){r.push(' class="');for(n=0;n<i.length;++n)r.push(" "+i[n]);r.push('"')}return r.push(">"),[r.join(""),"</"+a+">"]}function i(r){for(var t,e=[],n=e,o=0,i=0;o<r.length;++o){var a=r[o];if("\\"!=a){if("'"==a){for(var s=o==i;"'"!=r[++o];){if(o==r.length)throw new Error("lispTree: unterminated string");"\\"==r[o]&&++o}s&&(o==r.length-1||r[o+1].match(/[\s()]/))&&(n.push(r.substring(i+1,o)),i=o+1)}if('"'==a){for(s=o==i;'"'!=r[++o];){if(o==r.length)throw new Error("lispTree: unterminated string");"\\"==r[o]&&++o}s&&(o==r.length-1||r[o+1].match(/[\s()]/))&&(n.push(r.substring(i+1,o)),i=o+1)}if("("==a&&(i<o&&n.push(r.substring(i,o)),n.push(t=[]),t.parent=n,n=t,i=o+1),")"==a){if(i<o&&n.push(r.substring(i,o)),n==e)throw new Error("lispTree: xtra ')'");n=n.parent,i=o+1}if(a.match(/\s/)){for(i<o&&n.push(r.substring(i,o));o<r.length&&r[o].match(/\s/);)++o;i=o,--o}}else{if(o==r.length-1)throw new Error("lispTree: '\\' is last character");r=r.substring(0,o)+r.substring(o+1)}}if(n!=e)throw new Error("lispTree: xtra '('");return i<o&&e.push(r.substring(i,o)),e}function a(y){if("function"!=typeof y)throw new Error("LispMarkup markup conversion function: taghandler argument must be a function");return function r(t,e){var n={};var o=t[0];var i=null;var a=[""];if(null==t)return"";if("string"==typeof t||"number"==typeof t)return t.toString()+" ";"string"==typeof o&&(m.hasOwnProperty(o)?o=m[o]:i=o);if("function"==typeof o){var s=o,u=s(t,e,r);return"string"==typeof u?u:Array.isArray(u)?r(u,e):"object"==typeof u&&u.constructor=={}.constructor?u:u?u.toString():""}for(var p=0;p<t.length;++p)if(0!=p||!i){var f=t[p];if(Array.isArray(f)){var l=r(f,e);if("object"==typeof l&&l.constructor=={}.constructor)for(var c in l){var h=l[c];if(Array.isArray(h))n[c]=r(h,e);else if("string"==typeof h||"number"==typeof h)n[c]=h;else{if(null!=h)throw new Error("LispMarkup: illegal property value type.");n[c]=null}}else a.push(l)}else if("object"==typeof f)for(var c in f){var h=f[c];if(Array.isArray(h))n[c]=r(h,e);else if("string"==typeof h||"number"==typeof h)n[c]=h;else if(null==h)n[c]=null;else{if("function"!=typeof h)throw new Error("LispMarkup: illegal property value type.");var g=h,v=g(e);if("string"==typeof v)n[c]=v+" ";else{if(v)throw new Error("LispMarkup markup conversion function: template returned value with invalid type.");n[c]=""}}}else if("function"==typeof f){var g=f,v=g(e);if("string"==typeof v)a.push(v+" ");else{if(v)throw new Error("LispMarkup markup conversion function: template returned value with invalid type.");a.push("")}}else f&&a.push(f.toString()+" ")}if(i){var w=y(i,n);a[0]=w[0],a.push(w[1])}return a.join("")}}}"undefined"==typeof module?this.LispMarkup=r():module.exports=r()}();var LispMarkupBrowser={};!function(){var p={},a="-container",s="_data",u=/-content$|-template$/,f="text/lisp-markup";return LispMarkupBrowser.setContentTemplate=function(r,t){"string"==typeof t&&(t=LispMarkup.compileTemplate(t));if("function"!=typeof t)throw new Error("LispMarkupBrowser.setContentTemplate: Template must be a string in LispMarkup format or a function.");p[r]=t},LispMarkupBrowser.getContentTemplate=function(r){return p[r]},LispMarkupBrowser.updateAll=e,LispMarkupBrowser.updateContainers=c,LispMarkupBrowser.getContainers=l,window.addEventListener("load",function(){if(console.log("init lisp_markup.js in browser."),!LispMarkup)throw"LispMarkup library not available.";var r=function(){for(var r={},t=document.getElementsByTagName("script"),e=0;e<t.length;++e){var n=t[e],o=n.id,i=n.type,a=n.innerHTML;o&&(o=o.replace(u,"")),i==f&&(r[o]=a)}return r}();for(var t in r)console.log("LispMarkupBrowser: Compiling template: "+t),p[t]=LispMarkup.compileTemplate(r[t]);e()});function l(r){for(var t=[],e=r+a,n=document.getElementsByClassName(e),o=0;o<n.length;++o)t.push(n[o]);var i=document.getElementById(e);return i&&t.push(i),t}function e(r){if(null!==r&&null!=r||(r={}),"object"!=typeof r)throw new Error("LispMarkupBrowser.updateAll(): datasets parameter, if specified, must be an object.");for(var t in p)for(var e=l(t),n=0;n<e.length;++n)e[n].innerHTML="";for(var o=[],i={};;)if(0!=o.length){var a=o.shift();c(a,r[a])}else{var s=!1;for(var u in p){0<l(u).length&&(i.hasOwnProperty(u)||(s=!0,o.push(u),i[u]=!0))}if(!s)break}}function c(r,t){var e=l(r);if(0==e.length&&console.warn("LispMarkupBrowser updateContainer(): no container with name '"+r+"'."),void 0===t){var n=r+s;n in window&&(t=window[n],console.log(t))}for(var o=0;o<e.length;++o){var i=p[r];e[o].innerHTML=i(t)}}}();